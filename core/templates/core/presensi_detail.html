{% extends 'core/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                <h4 class="mb-0">Detail Presensi #{{ presensi.id }}</h4>
                <a href="{% url 'web-presensi-list' %}" class="btn btn-outline-secondary btn-sm">Kembali</a>
            </div>

            <div class="card-body">
                <div class="row">
                    <!-- Kolom Kiri: Foto -->
                    <div class="col-md-4 mb-3">
                        {% if presensi.selfie_photo %}
                        <img src="{{ presensi.selfie_photo.url }}" class="img-fluid rounded mb-2" alt="Selfie">
                        <div class="text-center">
                            <a href="{{ presensi.selfie_photo.url }}" target="_blank" class="btn btn-sm btn-outline-primary">Lihat Foto Penuh</a>
                        </div>
                        {% else %}
                        <div class="bg-light p-5 text-center text-muted rounded">No Photo</div>
                        {% endif %}
                    </div>

                    <!-- Kolom Kanan: Info -->
                    <div class="col-md-8">
                        <h5 class="mb-3">{{ presensi.petugas.first_name }} {{ presensi.petugas.last_name }}</h5>
                        <ul class="list-group list-group-flush mb-3">
                            <li class="list-group-item">
                                <strong>Waktu:</strong> {{ presensi.timestamp|date:"l, d F Y H:i" }} WIB
                            </li>
                            <li class="list-group-item">
                                <strong>Email:</strong> {{ presensi.petugas.email }}
                            </li>
                            <li class="list-group-item">
                                <strong>Catatan Harian:</strong><br>
                                {{ presensi.note|default:"-" }}
                            </li>
                        </ul>

                        <div class="card bg-light mb-3">
                            <div class="card-body p-3">
                                <h6>Lokasi Presensi</h6>
                                <p class="small mb-2">{{ presensi.location_note|default:"-" }}</p>
                                <div class="d-flex gap-2">
                                    <a href="https://www.google.com/maps?q={{ presensi.latitude }},{{ presensi.longitude }}" target="_blank" class="btn btn-sm btn-danger">
                                        <i class="fas fa-map-marker-alt"></i> Buka Peta
                                    </a>
                                    <div class="text-muted small align-self-center">
                                        Lat: {{ presensi.latitude }}, Long: {{ presensi.longitude }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Status Validasi -->
                        <div class="alert {% if presensi.status_validasi == 'hadir' %}alert-success{% elif presensi.status_validasi == 'tidak_hadir' %}alert-danger{% else %}alert-warning{% endif %}">
                            <strong>Status Validasi:</strong> 
                            {% if presensi.status_validasi == 'hadir' %}HADIR (Valid)
                            {% elif presensi.status_validasi == 'tidak_hadir' %}TIDAK HADIR (Tidak Valid)
                            {% else %}KEHADIRAN DILUAR LOKASI
                            {% endif %}
                        </div>

                        <!-- Form Ubah Status -->
                        <form method="post" class="mt-3 border-top pt-3">
                            {% csrf_token %}
                            <label class="form-label fw-bold">Ubah Status Validasi:</label>
                            <div class="input-group">
                                <select name="status_validasi" class="form-select">
                                    <option value="hadir" {% if presensi.status_validasi == 'hadir' %}selected{% endif %}>HADIR (Valid)</option>
                                    <option value="diluar_lokasi" {% if presensi.status_validasi == 'diluar_lokasi' %}selected{% endif %}>KEHADIRAN DILUAR LOKASI</option>
                                    <option value="tidak_hadir" {% if presensi.status_validasi == 'tidak_hadir' %}selected{% endif %}>TIDAK HADIR (Batalkan)</option>
                                </select>
                                <button type="submit" class="btn btn-primary">Simpan</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
